<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>How to import a public SSL certificate into AWS Certificate Manager on Windows - MoJ Modernisation Platform</title>

    <link href="../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/certificate-import-windows.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="user-guide.modernisation-platform.service.justice.gov.uk" />
      <meta name="twitter:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="How to import a public SSL certificate into AWS Certificate Manager on Windows - MoJ Modernisation Platform" />
      <meta name="twitter:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/certificate-import-windows.html" />

      <meta property="og:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="MoJ Modernisation Platform" />
      <meta property="og:title" content="How to import a public SSL certificate into AWS Certificate Manager on Windows" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/certificate-import-windows.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          MoJ Modernisation Platform
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide menu">Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/modernisation-platform">Home</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/modernisation-platform">GitHub</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://mojdt.slack.com/archives/C01A7QK5VM1">Slack</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="../">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://user-guide.modernisation-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#how-to-import-a-public-ssl-certificate-into-aws-certificate-manager-on-windows"><span>How to import a public SSL certificate into AWS Certificate Manager on Windows</span></a>
    <ul>
      <li>
        <a href="#introduction"><span>Introduction</span></a>
      </li>
      <li>
        <a href="#1-generate-the-csr-certificate-signing-request"><span>1. Generate the CSR (Certificate Signing Request)</span></a>
      </li>
      <li>
        <a href="#2-request-certificate"><span>2. Request certificate</span></a>
      </li>
      <li>
        <a href="#3-local-certificate-import"><span>3. Local certificate import</span></a>
      </li>
      <li>
        <a href="#4-local-certificate-export"><span>4. Local certificate export</span></a>
      </li>
      <li>
        <a href="#5-certificate-data-extraction-to-plaintext"><span>5. Certificate data extraction to plaintext</span></a>
      </li>
      <li>
        <a href="#6-aws-import"><span>6. AWS import</span></a>
      </li>
      <li>
        <a href="#7-attach-new-certificates"><span>7. Attach new certificates</span></a>
      </li>
      <li>
        <a href="#8-cleanup"><span>8. Cleanup</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="how-to-import-a-public-ssl-certificate-into-aws-certificate-manager-on-windows">How to import a public SSL certificate into AWS Certificate Manager on Windows</h1>
<h2 id="introduction">Introduction</h2>
<p>If you are not using a standard Modernisation Platform domain for your app, you will need to import your SSL certificate into your AWS account and apply it to your infrastructure. This guide <strong>does not</strong> cover the infrastructure element of this, only the import of SSL certificates into your AWS account.</p>
<p>This assumes you have read how to <a href="how-to-configure-dns.html">configure DNS</a> and have a basic understanding of SSL concepts, and access to openssl on the command line.</p>
<p>The steps are:</p>

<ul>
<li>Generate a certificate signing request (CSR)</li>
<li>Request a certificate using that CSR</li>
<li>Complete the certificate request</li>
<li>Export the complete certificate</li>
<li>Import the exported certificate data to your AWS account</li>
<li>Apply the certificate ARN to your app</li>
</ul>
<p>If you already have your exported SSL certificate in PFX format, skip direct to step 5 (certificate data extraction).</p>
<p>This guide was written using Windows to generate a certificate signing request (CSR) and complete the request. For Mac / Linux, the process will be similar, but you will need to research the commands for creating and completing a CSR, and ideally raise a PR to update this documentation to help other users.</p>
<p><strong>There may be a better way</strong>. If so, let us know!</p>
<h2 id="1-generate-the-csr-certificate-signing-request">1. Generate the CSR (Certificate Signing Request)</h2>
<p>Use PowerShell to execute the <code>certreq -new</code> command.</p>
<p>(The <code>performance-hub</code> repo has a PowerShell script which wraps the <code>certreq -new</code> command to generate a CSR and save it to a text file: <code>.\lib\generateCSR.ps1</code>)</p>
<h2 id="2-request-certificate">2. Request certificate</h2>
<p>Email certificates@digital.justice.gov.uk with the CSR(s) and domain(s), and they will send the certificates.</p>
<p>Note these will be plain text files with the body of the PEM-formatted server certificate from your certificate authority - no private key, and no certification chain (this is important later). The body of the PEM-formatted server certificate is an identity certificate that has been digitally signed using the private key of the certificate authority.</p>
<h2 id="3-local-certificate-import">3. Local certificate import</h2>
<p>In PowerShell, complete the certificate request, e.g.  <code>certreq -accept .\hmpps-your-app.service.justice.gov.uk.crt.txt</code></p>
<p>You should see something like:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>Installed Certificate:
Serial Number: a6700xxxxxxxxde8f8002
Subject: CN=hmpps-your-app.service.justice.gov.uk (DNS Name=hmpps-your-app.service.justice.gov.uk, DNS Name=www.hmpps-your-app.service.justice.gov.uk)
NotBefore: 21/03/2022 00:00
NotAfter: 15/04/2023 23:59
Thumbprint: fad171bxxxxxxxx27d40f
</code></pre></div><h2 id="4-local-certificate-export">4. Local certificate export</h2>
<p>Use the Windows Certificate Manager MMC to export the certificate. It should be in &ldquo;Personal&rdquo;.</p>

<ul>
<li>Say &ldquo;Yes&rdquo; to export the private key</li>
<li>Use .PFX as the format</li>
<li>Check &ldquo;include all certificates in the certification path if possible&rdquo;</li>
<li>Specify a password (not a Windows user) for security</li>
<li>Export to a file</li>
</ul>
<p><strong>TODO</strong> This step describes the GUI method. Investigate using PowerShell <code>Export-PfxCertificate</code> command (https://docs.microsoft.com/en-us/powershell/module/pki/export-pfxcertificate?view=windowsserver2022-ps)</p>
<h2 id="5-certificate-data-extraction-to-plaintext">5. Certificate data extraction to plaintext</h2>
<p>In a terminal, use this command to extract the certificate and private key: <code>Openssl pkcs12 -in prod-2022.pfx -out prod-cert.txt -nodes</code></p>
<p>Where &ldquo;prod-2022.pfx&rdquo; is the exported PFX file from the previous step, and &ldquo;prod-cert.txt&rdquo; is the output file containing plaintext certificate data. You will be prompted for the password you specified in the previous step.</p>
<p>The certificate block in this file should match the certificate block from step 2, but now the file will also contain a private key, and additional blocks for the certificate trust chain. &ldquo;Your&rdquo; certificate block will have your domain in the metadata.</p>
<h2 id="6-aws-import">6. AWS import</h2>
<p>In AWS Certificate Manager, import the certificate using the data in the exported plaintext file from the previous step (certificate body, certificate private key, and full certificate chain).</p>
<p>Regular Modernisation Platform AWS accounts do not have permission to import certificates, so a member of the core team will need to do this for you.</p>
<p>You can use the AWS Parameter Store to share the cert and key data with the Modernisation Platform team. The total length of the private key, certificate and chain exceeeds the 4096 character limit for parameters, so we suggest creating multiple parameters:</p>

<ul>
<li>One for the private key</li>
<li>One for your main certificate block</li>
<li>One parameter <strong>each</strong> for each block in the certificate chain</li>
</ul>
<p>If your are renewing an existing certificate, note that AWS Certificate Manager also allows you to re-import an existing certificate with new values. We suggest you avoid this in case something goes wrong. Importing a <strong>new</strong> certificate with the same domain as an existing certificate is allowed.</p>
<p>When importing the certificate, AWS may tell you that the trust chain is optional, but it&rsquo;s not. All of the additional certificate blocks (except your &ldquo;main&rdquo; cert) must be pasted into this field.</p>
<p>It&rsquo;s fine to include the metadata (e.g. &ldquo;bag attributes&rdquo;) when pasting certificate data into the import fields.</p>
<h2 id="7-attach-new-certificates">7. Attach new certificates</h2>
<p>Copy the ARN of your new certificate, edit the certificate ARN in Terraform, raise a PR and re-deploy the environment(s) to apply the new certificate.</p>
<p><code>modernisation-platform-environments\terraform\environments\your-app\application_variables.json</code> (it&rsquo;s the <code>cert_arn</code> value)</p>
<p>Test that your app working correctly, and check that the certificate expiry date reflects your new certificate.</p>
<h2 id="8-cleanup">8. Cleanup</h2>
<p>Clean up any copies of your certificate data (plaintext or otherwise). Remove:</p>

<ul>
<li>local copies of certificates from your cert store</li>
<li>local copies of certificate data in text files</li>
<li>certificate data in AWS parameter store</li>
</ul>

              <div data-module='page-expiry' data-last-reviewed-on="2023-01-01">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 1 July 2022.

        It needs to be reviewed again on 1 January 2023
        by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 1 January 2023
       by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/blob/main/source/user-guide/certificate-import-windows.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/issues/new?body=Problem+with+%27How+to+import+a+public+SSL+certificate+into+AWS+Certificate+Manager+on+Windows%27+%28https%3A%2F%2Fuser-guide.modernisation-platform.service.justice.gov.uk%2Fuser-guide%2Fcertificate-import-windows.html%29&amp;labels=bug&amp;title=Re%3A+%27How+to+import+a+public+SSL+certificate+into+AWS+Certificate+Manager+on+Windows%27">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../javascripts/application.js"></script>
  </body>
</html>
