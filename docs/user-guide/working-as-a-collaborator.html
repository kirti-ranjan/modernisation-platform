<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Working as a Collaborator - MoJ Modernisation Platform</title>

    <link href="../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/working-as-a-collaborator.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="user-guide.modernisation-platform.service.justice.gov.uk" />
      <meta name="twitter:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Working as a Collaborator - MoJ Modernisation Platform" />
      <meta name="twitter:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/working-as-a-collaborator.html" />

      <meta property="og:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="MoJ Modernisation Platform" />
      <meta property="og:title" content="Working as a Collaborator" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/working-as-a-collaborator.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          MoJ Modernisation Platform
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide menu">Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/modernisation-platform">Home</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/modernisation-platform">GitHub</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://mojdt.slack.com/archives/C01A7QK5VM1">Slack</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="../">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://user-guide.modernisation-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#working-as-a-collaborator"><span>Working as a Collaborator</span></a>
    <ul>
      <li>
        <a href="#logging-in-to-the-aws-console"><span>Logging in to the AWS Console</span></a>
      </li>
      <li>
        <a href="#getting-access-credentials"><span>Getting access credentials</span></a>
      </li>
      <li>
        <a href="#running-a-terraform-plan-locally-as-a-collaborator"><span>Running a Terraform plan locally as a collaborator</span></a>
      </li>
      <li>
        <a href="#accessing-ec2s-as-a-collaborator"><span>Accessing EC2s as a Collaborator</span></a>
        <ul>
          <li>
            <a href="#accessing-ec2s-with-ssm-agent-installed"><span>Accessing EC2s with SSM Agent installed</span></a>
          </li>
          <li>
            <a href="#accessing-ec2s-via-a-bastion"><span>Accessing EC2s via a bastion</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="working-as-a-collaborator">Working as a Collaborator</h1>
<p>Once you have been <a href="../runbooks/adding-collaborators.html">set up as a collaborator</a> you can -</p>

<ul>
<li><a href="creating-resources.html#creating-resources-in-the-modernisation-platform">create infrastructure in the modernisation-platform-environments repository</a></li>
<li><a href="deploying-your-infrastructure.html">deploy infrastrucutre via GitHub Actions workflows</a></li>
<li><a href="#logging-in-to-the-aws-console">view your accounts via the AWS console</a></li>
<li><a href="#getting-access-credentials">use AWS credentials</a></li>
<li><a href="#running-a-terraform-plan-locally-as-a-collaborator">run Terraform plans locally</a></li>
<li><a href="#accessing-ec2s-as-a-collaborator">access EC2s and databases</a></li>
</ul>
<h2 id="logging-in-to-the-aws-console">Logging in to the AWS Console</h2>

<ol>
<li><p>Click on the AWS Console url - <a href="https://eu-west-2.console.aws.amazon.com/">https://eu-west-2.console.aws.amazon.com/</a></p></li>
<li><p>You will see the sign on screen, choose IAM user and enter the Modernisation Platform landing zone account number (this will be provided to you on set up).</p></li>
<li><p>Enter your user details (your MFA and console password must be <a href="../runbooks/adding-collaborators.html#access-to-the-relevant-aws-accounts">set up first</a>)</p></li>
<li><p>Once you are logged in, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html">switch role</a> to the relevant account.</p></li>
<li><p>You will need to know the account number of the AWS account you want to switch to and the role you have been assigned, these will be told to you on initial user set up, the valid roles are:</p></li>
</ol>
<div class="table-container">
        <table>
          <tr>
<th>Role</th>
<th>Description</th>
<th>Typical User</th>
</tr><tr>
<td>developer</td>
<td>Read only console plus other permissions such as the ability to set secrets,restart EC2s, raise support tickets.</td>
<td>Used by engineers working on the application infrastructure</td>
</tr><tr>
<td>read-only</td>
<td>Read only console access</td>
<td>Used by read only users such as security testers</td>
</tr><tr>
<td>security-audit</td>
<td>AWS security-audit policy</td>
<td>Used by security testers</td>
</tr>
        </table>
      </div><p>You can see the accounts and roles assigned to you <a href="https://github.com/ministryofjustice/modernisation-platform/blob/main/collaborators.json">here</a></p>
<h2 id="getting-access-credentials">Getting access credentials</h2>
<p>AWS provides credentials which can give you programatic access to your AWS account. This enables you to run AWS CLI commandes or Terraform plans locally.</p>

<ul>
<li><a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys">Getting AWS Credentials</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html#cli-configure-profiles-create">Creating AWS profiles</a></li>
</ul>
<h2 id="running-a-terraform-plan-locally-as-a-collaborator">Running a Terraform plan locally as a collaborator</h2>
<p>To run a Terraform locally as a collaborator, you will need to get your AWS credentials, and use <a href="https://github.com/99designs/aws-vault">AWS Vault</a> or a similar tool to run Terraform using MFA.</p>
<p>You should follow the standard <a href="running-terraform-plan-locally.html">running terraform plan locally</a> instructions, ignoring the SSO section, running Terraform using AWS Vault and making one further code change:</p>
<p>Under the local plan section of the <code>providers.tf</code> file:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>######################### Run Terraform Plan Locally Only ##################################
# To run a Terraform Plan locally, uncomment this bottom section of code and comment out the top section

provider "aws" {
  region = "eu-west-2"
}
</code></pre></div><p>Add in an assume role block for the main provider with the account number that local plan is for, for example:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>######################### Run Terraform Plan Locally Only ##################################
# To run a Terraform Plan locally, uncomment this bottom section of code and comment out the top section

provider "aws" {
  region = "eu-west-2"
  assume_role {
    role_arn = "arn:aws:iam::&lt;my-account-number&gt;:role/developer"
  }
}
</code></pre></div><p>As with all local plan changes, please do not add these changes to version control or the CI/CD GitHub workflows will stop running.</p>
<h2 id="accessing-ec2s-as-a-collaborator">Accessing EC2s as a Collaborator</h2>
<p>You will need to have the <code>developer</code> access role in order to use SSM/Bastion.</p>

<ol>
<li>Download the <a href="https://aws.amazon.com/cli/">AWS CLI</a></li>
<li>Ensure you have your <a href="#getting-access-credentials">AWS credentials</a></li>
<li>In your terminal enter <code>aws configure</code> to set up credentials and enter the key and access key created in the previous step. </li>
<li>Open <code>~/.aws/config</code> in a text editor and enter the following to create your AWS profile: </li>
</ol>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>[profile &lt;my-application-account-name&gt;]
source_profile = default
role_arn:arn:aws:iam::&lt;your application account number&gt;:role/developer
mfa_serial = arn:aws:iam::&lt;landing zone account number&gt;:mfa/&lt;your user name&gt;
role_session_name=&lt;my-application-account-name&gt;
</code></pre></div><h3 id="accessing-ec2s-with-ssm-agent-installed">Accessing EC2s with SSM Agent installed</h3>
<p>Most modern AMIs will already have the SSM Agent installed. You can connect to these instances directly with Session Manager.</p>

<ol>
<li>Start a basic Session Manager session</li>
</ol>
<p><code>aws ssm start-session --target i-12345bc --profile &lt;my aws profile&gt;</code></p>
<h3 id="accessing-ec2s-via-a-bastion">Accessing EC2s via a bastion</h3>

<ol>
<li>Create a bastion EC2 using the <a href="https://github.com/ministryofjustice/modernisation-platform-terraform-bastion-linux">bastion module</a></li>
<li>Create or share your public key and preferred username as detailed in the <a href="https://github.com/ministryofjustice/modernisation-platform-terraform-bastion-linux#readme">bastion readme</a></li>
<li>Open <code>~/.ssh/config</code> in a text editor and enter the following:</li>
</ol>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>Host bastion
     IdentityFile ~/.ssh/id_rsa #local path to the public key provided in earlier
     User &lt;your user name&gt; 
     ProxyCommand sh -c "aws ssm start-session --target $(aws ec2 describe-instances --no-cli-pager --filters "Name=tag:Name,Values=bastion_linux" --query 'Reservations[0].Instances[0].InstanceId' --profile &lt;my aws profile&gt;) --document-name AWS-StartSSHSession --parameters 'portNumber=%p' --profile &lt;my aws profile&gt; --region eu-west-2"
</code></pre></div>
<ol>
<li>To SSH or other port tunneling (eg to connect to a database) through the bastion to your EC2 instance, using the relevant ports:</li>
</ol>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>  ssh -L 33389:&lt;IP address of destination instance&gt;:3389 bastion
</code></pre></div>
              <div data-module='page-expiry' data-last-reviewed-on="2022-09-15">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 15 March 2022.

        It needs to be reviewed again on 15 September 2022
        by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 15 September 2022
       by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/blob/main/source/user-guide/working-as-a-collaborator.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/issues/new?body=Problem+with+%27Working+as+a+Collaborator%27+%28https%3A%2F%2Fuser-guide.modernisation-platform.service.justice.gov.uk%2Fuser-guide%2Fworking-as-a-collaborator.html%29&amp;labels=bug&amp;title=Re%3A+%27Working+as+a+Collaborator%27">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../javascripts/application.js"></script>
  </body>
</html>
