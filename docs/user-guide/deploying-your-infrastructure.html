<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Deploying Your Infrastructure - MoJ Modernisation Platform</title>

    <link href="../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/deploying-your-infrastructure.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="user-guide.modernisation-platform.service.justice.gov.uk" />
      <meta name="twitter:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Deploying Your Infrastructure - MoJ Modernisation Platform" />
      <meta name="twitter:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/deploying-your-infrastructure.html" />

      <meta property="og:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="MoJ Modernisation Platform" />
      <meta property="og:title" content="Deploying Your Infrastructure" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/deploying-your-infrastructure.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          MoJ Modernisation Platform
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide menu">Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/modernisation-platform">Home</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/modernisation-platform">GitHub</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://mojdt.slack.com/archives/C01A7QK5VM1">Slack</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="../">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://user-guide.modernisation-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#deploying-your-infrastructure"><span>Deploying Your Infrastructure</span></a>
    <ul>
      <li>
        <a href="#create-a-pull-request"><span>Create a pull request</span></a>
      </li>
      <li>
        <a href="#github-actions-workflow"><span>GitHub Actions Workflow</span></a>
        <ul>
          <li>
            <a href="#jobs-on-pull-request"><span>Jobs on pull request</span></a>
          </li>
          <li>
            <a href="#jobs-on-merging-a-pull-request"><span>Jobs on merging a pull request</span></a>
          </li>
          <li>
            <a href="#viewing-terraform-plans"><span>Viewing Terraform plans</span></a>
          </li>
          <li>
            <a href="#approving-deployments"><span>Approving deployments</span></a>
          </li>
          <li>
            <a href="#checks"><span>Checks</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#more-information"><span>More information</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="deploying-your-infrastructure">Deploying Your Infrastructure</h1>
<p>Once you have <a href="creating-resources.html">defined your infrastructure as code</a> and pushed your changes to the repository you can now deploy your infrastructure.</p>
<h2 id="create-a-pull-request">Create a pull request</h2>
<p>The first step is to create a pull request this will trigger the <a href="https://docs.github.com/en/actions">GitHub actions</a> workflow for your application.</p>
<h2 id="github-actions-workflow">GitHub Actions Workflow</h2>
<p>Workflow files are found <a href="https://github.com/ministryofjustice/modernisation-platform-environments/tree/main/.github/workflows">here</a> and are named after your application.</p>
<p>Depending on what <a href="creating-environments.html">environments</a> you have, some jobs in the workflow may be commented out if they are not needed.  They can be uncommented if more enviroments are added or safely removed if not needed.</p>
<p>Any changes to your workflow file will need approval from the Modernisation Platform team.</p>
<p>Here is a high level diagram of what the workflow file does.</p>
<p><a href="../images/environment-workflow.png" rel="noopener noreferrer"><img src="../images/environment-workflow.png" alt="Environment Workflow" /></a></p>
<h3 id="jobs-on-pull-request">Jobs on pull request</h3>

<ul>
<li>a <a href="https://www.terraform.io/docs/cli/commands/plan.html">Terraform plan</a> on the <code>development</code> and <code>test</code> environments (if you have them).</li>
<li>a <a href="https://www.terraform.io/docs/cli/commands/apply.html">Terraform apply</a> on the <code>development</code> and <code>test</code> environments (if you have them), which is held until a reviewer from your GitHub team approves the deployment.</li>
</ul>
<h3 id="jobs-on-merging-a-pull-request">Jobs on merging a pull request</h3>

<ul>
<li>a <a href="https://www.terraform.io/docs/cli/commands/plan.html">Terraform plan</a> on the <code>preproduction</code> and <code>production</code> environments (if you have them).</li>
<li>a <a href="https://www.terraform.io/docs/cli/commands/apply.html">Terraform apply</a> on the <code>preproduction</code> and <code>production</code> environments (if you have them), which is held until a reviewer from your GitHub team approves the deployment.</li>
</ul>
<h3 id="viewing-terraform-plans">Viewing Terraform plans</h3>

<ol>
<li>Navigate to the <a href="https://github.com/ministryofjustice/modernisation-platform-environments/actions">Actions</a> tab in the environments repository.</li>
<li>Find the relevant workflow run (the name is the name of your pull request or merge commit)</li>
<li>Click on the <code>Plan &lt;environment&gt; - &lt;application name&gt;</code> job</li>
<li>Expand the <code>Terraform plan - &lt;environment&gt;</code> drop down</li>
</ol>
<h3 id="approving-deployments">Approving deployments</h3>
<p>The Modernisation Platform uses <a href="https://www.terraform.io/docs/language/state/workspaces.html">Terraform Workspaces</a> and <a href="https://docs.github.com/en/actions/reference/environments">GitHub Environments</a> for deployments and approvals to your different environments.</p>

<ol>
<li>Navigate to the <a href="https://github.com/ministryofjustice/modernisation-platform-environments/actions">Actions</a> tab in the environments repository.</li>
<li>Find the relevant workflow run (the name is the name of your pull request or merge commit)</li>
<li>Click on the <code>Review deployments</code> button</li>
<li>Tick the box and <code>Approve and deploy</code></li>
<li>The <code>Deploy &lt;environment&gt; - &lt;application&gt;</code> job will then run and deploy your infrastructure.  Any issues or failures can been seen in this job.</li>
</ol>
<h3 id="checks">Checks</h3>
<p>Some additional workflow checks will run when you create a pull request, this is to help ensure code on the Modernisation Platform meets the highest quality standards. Some of the checks are required which means you will not be able to merge the pull request until the issue is resolved.</p>
<div class="table-container">
        <table>
          <tr>
<th>Check</th>
<th>Description</th>
<th>Required</th>
</tr><tr>
<td><a href="https://github.com/ministryofjustice/github-actions/tree/main/code-formatter">Code Formatter</a></td>
<td>Runs a code formatter and commits any changes back to the branch</td>
<td>No</td>
</tr><tr>
<td><a href="https://github.com/ministryofjustice/modernisation-platform-environments/blob/main/policies/terraform/deny.rego">Open Policy Agent (OPA) validation</a></td>
<td>Runs OPA tests which check the Terraform and prevents certain changes for security reasons. If you want to make a change which is not allowed by the validation, please contact the Modernisation Platform team</td>
<td>Yes</td>
</tr><tr>
<td><a href="https://github.com/ministryofjustice/github-actions/tree/main/terraform-static-analysis">Terraform Static Code Analysis</a></td>
<td>Runs any changes through <a href="https://github.com/tfsec/tfsec">TFSEC</a>, <a href="https://github.com/bridgecrewio/checkov">Checkov</a> and <a href="https://github.com/terraform-linters/tflint">tflint</a>. If any issues are flagged please try to fix them, if there is a valid reason not to fix them they can be ignored with inline ignore comments.</td>
<td>No - but we may make this mandatory at a later date</td>
</tr>
        </table>
      </div><h2 id="more-information">More information</h2>
<p>For more details information on the workflow and concepts behind it please see the <a href="../concepts/sdlc/user-workflow.html">User Workflow</a> concepts guidance.
For instructions on how to run a Terraform plan locally see <a href="running-terraform-plan-locally.html">here</a></p>

              <div data-module='page-expiry' data-last-reviewed-on="2022-08-16">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 16 February 2022.

        It needs to be reviewed again on 16 August 2022
        by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 16 August 2022
       by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/blob/main/source/user-guide/deploying-your-infrastructure.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/issues/new?body=Problem+with+%27Deploying+Your+Infrastructure%27+%28https%3A%2F%2Fuser-guide.modernisation-platform.service.justice.gov.uk%2Fuser-guide%2Fdeploying-your-infrastructure.html%29&amp;labels=bug&amp;title=Re%3A+%27Deploying+Your+Infrastructure%27">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../javascripts/application.js"></script>
  </body>
</html>
