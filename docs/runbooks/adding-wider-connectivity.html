<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Adding Wider Connectivity to the Modernisation Platform - MoJ Modernisation Platform</title>

    <link href="../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://user-guide.modernisation-platform.service.justice.gov.uk/runbooks/adding-wider-connectivity.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="user-guide.modernisation-platform.service.justice.gov.uk" />
      <meta name="twitter:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Adding Wider Connectivity to the Modernisation Platform - MoJ Modernisation Platform" />
      <meta name="twitter:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/runbooks/adding-wider-connectivity.html" />

      <meta property="og:image" content="https://user-guide.modernisation-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="MoJ Modernisation Platform" />
      <meta property="og:title" content="Adding Wider Connectivity to the Modernisation Platform" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://user-guide.modernisation-platform.service.justice.gov.uk/runbooks/adding-wider-connectivity.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          MoJ Modernisation Platform
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide menu">Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/modernisation-platform">Home</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/modernisation-platform">GitHub</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://mojdt.slack.com/archives/C01A7QK5VM1">Slack</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="../">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://user-guide.modernisation-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#adding-wider-connectivity-to-the-modernisation-platform"><span>Adding Wider Connectivity to the Modernisation Platform</span></a>
    <ul>
      <li>
        <a href="#introduction"><span>Introduction</span></a>
      </li>
      <li>
        <a href="#required-routing"><span>Required Routing</span></a>
        <ul>
          <li>
            <a href="#egress-from-the-mp-tgw-to-pttp-tgw"><span>Egress from the MP TGW to PTTP TGW</span></a>
          </li>
          <li>
            <a href="#from-pttp-tgw-to-the-new-connectivity-location"><span>From PTTP TGW to the new connectivity location</span></a>
          </li>
          <li>
            <a href="#from-pttp-tgw-back-to-the-mp-tgw"><span>From PTTP TGW back to the MP TGW</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#cloud-platform-connectivity"><span>Cloud Platform Connectivity</span></a>
      </li>
      <li>
        <a href="#diagram"><span>Diagram</span></a>
      </li>
      <li>
        <a href="#other-steps"><span>Other Steps</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="adding-wider-connectivity-to-the-modernisation-platform">Adding Wider Connectivity to the Modernisation Platform</h1>
<h2 id="introduction">Introduction</h2>
<p>The Modernisation Platform connects the different core platform VPCs and core networking VPCs using <a href="https://aws.amazon.com/transit-gateway/">AWS Transit Gateway</a>.</p>
<p>In order to expand connectivity beyond the Modernisation Platform, we have <a href="https://docs.aws.amazon.com/vpc/latest/tgw/tgw-peering.html">peered</a> the Modernisation Platform Transit Gateway (MP TGW) to the central <a href="https://github.com/ministryofjustice/deployment-tgw">MoJ PTTP Transit Gateway</a> (Prison Technology Transformation Project) (PTTP TGW).</p>
<p>Whilst we could directly connect things to our Modernisation Transit Gateway, this would end up with lots of cross networking between platforms and additional complexity.  It makes sense to use the PTTP TWG as a central hub for connectivity across the MoJ.</p>
<h2 id="required-routing">Required Routing</h2>
<h3 id="egress-from-the-mp-tgw-to-pttp-tgw">Egress from the MP TGW to PTTP TGW</h3>
<p>An egress route out of the platform must be added <a href="https://github.com/ministryofjustice/modernisation-platform/blob/main/terraform/environments/core-network-services/transit_gateway_connections.tf#L73">here</a> to the appropriate non_live or live map.</p>
<h3 id="from-pttp-tgw-to-the-new-connectivity-location">From PTTP TGW to the new connectivity location</h3>
<p>A static route to the correct <a href="https://docs.aws.amazon.com/vpc/latest/tgw/working-with-transit-gateways.html">TGW attachement</a> should be added under <code>attachment_static_routes</code> <a href="https://github.com/ministryofjustice/deployment-tgw/blob/master/env/production/config.yml">here</a>.</p>

<ul>
<li><code>rtb_name</code> (route table name) should be <code>tgw-rtb-modplatform</code>. This is the route table associated with the MP TGW peering connection.</li>
<li><code>destination</code> should be the CIDR range of the new connectivity location.</li>
<li><code>attach_id</code> is the ID of the TGW attachment for the new location.</li>
</ul>
<p>The TGW attachement may be a VPC, VPN, Direct Connect or another Transit Gateway. If it is another Transit Gateway, you will need additional routes in that gateway (see the Cloud Platform example below).</p>
<h3 id="from-pttp-tgw-back-to-the-mp-tgw">From PTTP TGW back to the MP TGW</h3>
<p>A route to the MP TGW must be added in the relevant route table for the PTTP TGW attachement.  This should be added under <code>peering_static_routes</code> <a href="https://github.com/ministryofjustice/deployment-tgw/blob/master/env/production/config.yml">here</a>.</p>

<ul>
<li><code>rtb_name</code> is the name of the relevant route table. This is the route table associated with the attachment.</li>
<li><code>destination</code> should be the CIDR range of the Modernisation live or non live CIDR ranges.</li>
<li><code>peering_name</code> should be <code>PTTP-ModernisationPlatform</code></li>
</ul>
<p>Most PTTP TGW attachments come in to the <code>tgw-rtb-security</code> or the <code>tgw-rtb-probation</code> route tables, the Modernisation Platform ranges have been added to these already so there is no need to add them again, but new tables may be added in the future.</p>
<h2 id="cloud-platform-connectivity">Cloud Platform Connectivity</h2>
<p>Connectivity through to the Cloud Platform goes through <a href="https://github.com/ministryofjustice/transit-gateways">additional Transit Gateways</a>.
Along with the steps above routes were added <a href="https://github.com/ministryofjustice/transit-gateways/pull/10/files">here</a>.
This has been done for the Modernisation Platform live and non live environments, so no further routing is needed to connect to the Cloud Plaform, only steps detailed <a href="#other-steps">here</a>.</p>
<h2 id="diagram">Diagram</h2>
<p>A high level diagram of the wider MoJ networking can be found <a href="https://drive.google.com/file/d/1w8dZs5vZOoy0dvCnRr5P6GHc3VQRdwLq/view?usp=sharing">here</a>.</p>
<h2 id="other-steps">Other Steps</h2>
<p>Remember to do the following in addition to the above in the Modernisation Platform to allow traffic:</p>

<ul>
<li>Add appropriate Firewall rules</li>
<li>Open appropriate NACLs for the business unit subnet sets per relevant environment</li>
<li>Add allow rules to the appropriate Security Groups</li>
</ul>

              <div data-module='page-expiry' data-last-reviewed-on="2022-11-24">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 24 May 2022.

        It needs to be reviewed again on 24 November 2022
        by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 24 November 2022
       by the page owner <a href="https://mojdt.slack.com/messages/modernisation-platform">#modernisation-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/blob/main/source/runbooks/adding-wider-connectivity.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform/issues/new?body=Problem+with+%27Adding+Wider+Connectivity+to+the+Modernisation+Platform%27+%28https%3A%2F%2Fuser-guide.modernisation-platform.service.justice.gov.uk%2Frunbooks%2Fadding-wider-connectivity.html%29&amp;labels=bug&amp;title=Re%3A+%27Adding+Wider+Connectivity+to+the+Modernisation+Platform%27">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/modernisation-platform">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../javascripts/application.js"></script>
  </body>
</html>
